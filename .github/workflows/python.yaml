name: Test Python Files
defaults:
  run:
    working-directory: python

on:
  push:
    branches:
      - main

env:
  PYTHONPATH: .

jobs:
  test_utilities:
    runs-on: ubuntu-latest
    container:
      image: python:latest

    steps:
      - uses: actions/checkout@v3
      - run: python -m pip install poetry
      - run: poetry install --only testing
      - run: poetry run ward test -p utils

  test_2022:
    runs-on: ubuntu-latest
    container:
      image: python:latest

    steps:
      - uses: actions/checkout@v3
      - run: python -m pip install poetry
      - run: poetry install --only testing
      - run: poetry run ward test -p year2022

  coverage:
    runs-on: ubuntu-latest
    container:
      image: python:latest

    steps:
      - uses: actions/checkout@v3
      # - run: python -m pip install poetry
      # - run: poetry install --only testing
      # - run: poetry run coverage run -m ward test && poetry run coverage xml
      - uses: ./.github/actions/coverage/
        id: coverage
      # - run: |
      #     curl https://uploader.codecov.io/verification.gpg | gpg --no-default-keyring --keyring trustedkeys.gpg --import && \
      #     curl -Os https://uploader.codecov.io/latest/linux/codecov && \
      #     curl -Os https://uploader.codecov.io/latest/linux/codecov.SHA256SUM && \
      #     curl -Os https://uploader.codecov.io/latest/linux/codecov.SHA256SUM.sig && \
      #     gpgv codecov.SHA256SUM.sig codecov.SHA256SUM && \
      #     shasum -a 256 -c codecov.SHA256SUM && \
      #     chmod +x codecov
      # - run: ./codecov -t ${{ secrets.CODECOV_TOKEN }} -f coverage.xml -d
